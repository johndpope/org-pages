# -*- mode: org; -*-
#+OPTIONS: toc:2
#+OPTIONS: ^:nil
#+AUTHOR manue1
#+EXPORT_FILE_NAME centos
#+SETUPFILE: setup.org
#+TITLE: note-linux-centos

* VboxManage
   
  - vms åŸºæœ¬ä¿¡æ¯
    
    VBoxManage showvminfo Centos701

  - æ— ç•Œé¢å¯åŠ¨vms

    VBoxManage startvm Centos701 --type headless

    VBoxManage controlvm ubuntu01 savestate # ä¿å­˜å½“å‰çŠ¶æ€å…³é—­

  - ä¿®æ”¹vmså†…å­˜æ€»é‡

    VBoxManage modifyvm Centos701 --memory 1024
    
  - ä¿®æ”¹vmsç£ç›˜å®¹é‡

    VBoxManage modifyhd Centos702.vdi --resize 7168

    #+BEGIN_SRC 
   
å¦‚æœåˆ›å»ºè¿‡å¿«ç…§ï¼Œå¿«ç…§çš„ç£ç›˜ç©ºé—´ä¹Ÿéœ€è¦ä¿®æ”¹
VBoxManage modifyhd \{aea51811-5e79-46e9-b5ba-f66740e6f47b\}.vdi  --resize 10248
    
    #+END_SRC

  - åˆ›å»ºå¿«ç…§
    
    VBoxManage snapshot ubuntu01 take ubuntu_basic_ssh

    VBoxManage snapshot ubuntu01 list

    VBoxManage snapshot ubuntu01 delete ubuntu_basic

    VBoxManage snapshot ubuntu01 restore ubuntu_basic_ssh

  - clone vm

    VBoxManage clonevm  Centos701 --snapshot  centos7_basic  --name Centos_basic
    


    
#+BEGIN_SRC 

æŸ¥çœ‹å½“å‰è™šæ‹Ÿæœº  VBoxManage list vms  

æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœº  VBoxManage list runningvms  

å¯åŠ¨è™šæ‹Ÿæœº  VBoxManage startvm è™šæ‹Ÿæœºå  

æ— å‰ç«¯å›¾å½¢ç•Œé¢æ–¹å¼å¯åŠ¨è™šæ‹Ÿæœº  VBoxManage startvm è™šæ‹Ÿæœºå --type headless  

ä½¿ç”¨ VRDP æ–¹å¼é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨è™šæ‹Ÿæœºï¼š (3389)  
VBoxManage startvm è™šæ‹Ÿæœºå --type vrdp  

å…³é—­è™šæ‹Ÿæœº  VBoxManage controlvm è™šæ‹Ÿæœºå poweroff  

VBoxManage [-v|-version]         æ˜¾ç¤ºvirtualboxçš„ç‰ˆæœ¬å·  
VBoxManage -nologo               éšè—logo  
VBoxManage -convertSettings      å…è®¸è‡ªåŠ¨è½¬æ¢è®¾ç½®æ–‡ä»¶  
VBoxManage -convertSettingsBackup å…è®¸è‡ªåŠ¨è½¬æ¢è®¾ç½®æ–‡ä»¶ï¼Œå¹¶åœ¨è½¬æ¢å‰ä½œå¤‡ä»½  
VBoxManage -convertSettingsIgnore å…è®¸è‡ªåŠ¨è½¬æ¢è®¾ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸ä¿å­˜ç»“æœ  

VBoxManage list vms|runningvms   æ˜¾ç¤ºåˆ—è¡¨è™šæ‹Ÿæœº|æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœº  
               |ostypes|hostdvds virtualboxæ”¯æŒçš„ç³»ç»Ÿç±»å‹|å®¿ä¸»æœºçš„å…‰ç›˜é©±åŠ¨å™¨  
               |hostfloppies     å®¿ä¸»æœºçš„è½¯ç›˜é©±åŠ¨å™¨  

               |hostifs|hostinfo å®¿ä¸»æœºçš„ç½‘ç»œæ¥å£|å®¿ä¸»æœºçš„ä¿¡æ¯  
               |hdds|dvds        å·²æ³¨å†Œçš„è™šæ‹Ÿç¡¬ç›˜|å·²æ³¨å†Œçš„è™šæ‹Ÿå…‰ç›˜  
               |floppies|usbhost å·²æ³¨å†Œçš„è™šæ‹Ÿè½¯ç›˜|å®¿ä¸»æœºçš„USBè®¾å¤‡  
               |usbfilters       USBç­›é€‰å™¨  
               |systemproperties è™šæ‹Ÿæœºçš„åŸºæœ¬ä¿¡æ¯  
VBoxManage showvminfo <uuid>|<name>     æ˜¾ç¤ºæŒ‡å®šè™šæ‹Ÿæœºçš„ä¿¡æ¯  
                     [-details]         æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯  
                     [-statistics]      æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯  
                     [-machinereadable] ä»¥æ¸…æ™°çš„æ ¼å¼æ˜¾ç¤ºè™šæ‹Ÿæœºä¿¡æ¯  
VBoxManage registervm <filename>       å°†æŒ‡å®šæ–‡ä»¶æ‰€åœ¨çš„è™šæ‹Ÿæœºæ·»åŠ åˆ°åˆ—è¡¨  
VBoxManage unregistervm <uuid>|<name>   ä»è™šæ‹Ÿæœºåˆ—è¡¨æ¸…é™¤æŒ‡å®šçš„è™šæ‹Ÿæœº  
                        [-delete]       ä»è™šæ‹Ÿæœºåˆ—è¡¨åˆ é™¤æŒ‡å®šçš„è™šæ‹Ÿæœº  
VBoxManage createvm     -name <name>    åˆ›å»ºæŒ‡å®šåç§°çš„è™šæ‹Ÿæœº  
                        [-register]      å°†åˆ›å»ºçš„è™šæ‹Ÿæœºæ·»åŠ åˆ°åˆ—è¡¨  
                        [-basefolder <path> æŒ‡å®šè™šæ‹Ÿæœºçš„åŸºç¡€ç›®å½•  
                        [-settingsfile <path>] æŒ‡å®šè™šæ‹Ÿæœºé…ç½®æ–‡ä»¶çš„åŸºç¡€ç›®å½•  
                        [-uuid <uuid>] åˆ›å»ºæŒ‡å®šuuidçš„è™šæ‹Ÿæœº  
VBoxManage modifyvm     <uuid|name>       ç¼–è¾‘æŒ‡å®šçš„è™šæ‹Ÿæœºçš„é…ç½®  
                        [-name <name>]    ä¿®æ”¹è™šæ‹Ÿæœºçš„åç§°  
                        [-ostype <ostype>]ä¿®æ”¹è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿç±»å‹  
                        [-memory <memorysize>]   ä¿®æ”¹è™šæ‹Ÿæœºçš„å†…å­˜å¤§å°  
                        [-vram <vramsize>]       ä¿®æ”¹è™šæ‹Ÿæœºçš„æ˜¾å­˜å¤§å°  
                        [-acpi on|off]           å¯åŠ¨æˆ–ç¦æ­¢acpiç”µæºç®¡ç†æ¥å£  
                        [-ioapic on|off]         å¯åŠ¨æˆ–ç¦æ­¢I/O APICç”µæºç®¡ç†æ¥å£  
                        [-pae on|off]            å¯åŠ¨æˆ–ç¦æ­¢CPUçš„PAEæ”¯æŒï¼ŒPAEæ˜¯  
Physical Address Extension : ç‰©ç†åœ°å€æ‰©å±•  
                        [-hwvirtex on|off|default]å¯åŠ¨æˆ–ç¦æ­¢CPUçš„ç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ  
                        [-nestedpaging on|off]    å¼€å¯æˆ–å…³é—­CPUçš„åµŒå¥—é¡µé¢åˆ—è¡¨æ”¯æŒ  
                        [-monitorcount <number>] è®¾ç½®æ˜¾ç¤ºå™¨æ•°ç›®ï¼ŒVRDPå¤šç”¨æˆ·æ¨¡å¼æ—¶  
                        [-bioslogofadein on|off] å¼€å¯æˆ–å…³é—­bioslogoæ¸æ˜¾æ•ˆæœ  
                        [-bioslogofadeout on|off] å¼€å¯æˆ–å…³é—­bioslogoæ¸éšæ•ˆæœ  
                        [-bioslogodisplaytime <msec>]è®¾ç½®bioslogoæ˜¾ç¤ºæ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½)  
                        [-bioslogoimagepath <imagepath>]è®¾ç½®bioslogoå›¾åƒè·¯å¾„ï¼Œç”¨äºè‡ªå®šä¹‰bioslogo  
                        [-biosbootmenu disabled| è®¾ç½®æ˜¯å¦æ˜¾ç¤ºbioså¯åŠ¨èœå• å…³é—­  
                                       menuonly| åªèœå•  
                                       messageandmenu] ä¿¡æ¯å’Œèœå•  
                        [-biossystemtimeoffset <msec>] è®¾ç½®biosç³»ç»Ÿæ—¶é—´è¡¥å¿ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰  
                        [-biospxedebug on|off] æ‰“å¼€æˆ–å…³é—­biospxeè°ƒè¯•  
                        [-boot<1-4> none|floppy|dvd|disk|net>] è®¾ç½®å¯åŠ¨é¡ºåº  
                        [-hd<a|b|d> none|<uuid>|<filename>] ä¸ºè™šæ‹Ÿæœºæ·»åŠ ä¸‰ä¸ªIDEè®¾å¤‡ä¹‹ä¸€ï¼ˆç¬¬2ä¸ªä¸»ç›˜è¢«vmä¿ç•™ä½œä¸ºå…‰é©±ï¼Œä¸èƒ½å ç”¨ï¼‰åœ¨ä¸‰ä¸ªIDEä¸­ï¼Œä½ å¯ä»¥æŒ‡å®šï¼ˆç¡¬ç›˜ï¼‰çš„vdiæ–‡ä»¶åæˆ–è€…å®ƒçš„UUID  
                        [-idecontroller PIIX3|PIIX4] è®¾ç½®IDEæ§åˆ¶å™¨çš„ç±»å‹  
                        [-sata on|off] å¼€å¯æˆ–å…³é—­SATAç¡¬ç›˜æ§åˆ¶å™¨  
                        [-sataportcount <1-30>] è®¾ç½®è™šæ‹Ÿæœºæœ€å¤šæ”¯æŒçš„SATAæ§åˆ¶å™¨æ•°ç›®  
                        [-sataport<1-30> none| æ²¡æœ‰ç¡¬ç›˜è¿æ¥åˆ°SATAæ§åˆ¶å™¨  
                                       <uuid>| æŒ‡å®šuuidçš„ç¡¬ç›˜è¿æ¥åˆ°SATAæ§åˆ¶å™¨  
                                       <filename>] æŒ‡å®šæ–‡ä»¶åçš„ç¡¬ç›˜è¿æ¥åˆ°SATAæ§åˆ¶å™¨  
                        [-sataideemulation<1-4> <1-30>] æŒ‡å®šä¸€ä¸ªSATAè®¾å¤‡å·¥ä½œåœ¨IDEå…¼å®¹æ¨¡å¼ï¼ŒIDEè®¾å¤‡ç¼–å·æ˜¯1-4ï¼ŒSATAè®¾å¤‡ç¼–å·æ˜¯1-30  
                        [-dvd none| ä¸è¿æ¥DVDå…‰é©±  
                            <uuid>| æŒ‡å®šUUIDçš„DVDå…‰é©±è¿æ¥  
                        <filename>| å°†æŒ‡å®šçš„å…‰ç›˜æ˜ åƒæ–‡ä»¶æŒ‚æ¥åˆ°DVDå…‰é©±  
                      host:<drive>] å°†å®¿ä¸»æœºçš„DVDå…‰é©±æŒ‚æ¥åˆ°è™šæ‹Ÿæœºçš„DVDå…‰é©±  
                        [-dvdpassthrough on|off]æ‰“å¼€|å…³é—­è™šæ‹Ÿæœºé‡Œå…‰ç›˜çš„åˆ»å½•åŠŸèƒ½  
                        [-floppy disabled| ä¸è¿æ¥è½¯é©±  
                                    empty| è¿æ¥è½¯é©±ä½†ä¸æ’å…¥è½¯ç›˜  
                                   <uuid>| æŒ‡å®šUUIDçš„è½¯é©±è¿æ¥  
                               <filename>| å°†æŒ‡å®šçš„è½¯ç›˜æ˜ åƒæ–‡ä»¶æŒ‚æ¥åˆ°è½¯é©±é©±  
                             host:<drive>] å°†å®¿ä¸»æœºçš„è½¯é©±é©±æŒ‚æ¥åˆ°è™šæ‹Ÿæœºçš„è½¯é©±  
                        [-nic<1-N> none| è™šæ‹Ÿæœºä¸æ·»åŠ ç½‘å¡  
                                   null| è™šæ‹Ÿæœºæœ‰ç½‘å¡ä½†ä¸è¿æ¥  
                                    nat| ç½‘ç»œè¿æ¥ä½¿ç”¨NATæ¨¡å¼  
                                 hostif| ç½‘ç»œè¿æ¥ä½¿ç”¨æ¡¥æ¥æ¨¡å¼  
                                 intnet] ç½‘ç»œè¿æ¥ä½¿ç”¨å†…éƒ¨ç½‘ç»œæ¨¡å¼  
                        [-nictype<1-N> Am79C970A| è™šæ‹Ÿæœºè¿æ¥AMD PCNet PCI IIç½‘å¡  
                                        Am79C973| è™šæ‹Ÿæœºè¿æ¥AMD PCNet FAST IIIç½‘å¡ï¼ˆé»˜è®¤ï¼‰  
                                         82540EM| è™šæ‹Ÿæœºè¿æ¥Intel PRO/1000 MT Desktopç½‘å¡  
                                         82543GC] è™šæ‹Ÿæœºè¿æ¥Intel PRO/1000 T Serverç½‘å¡  
                        [-cableconnected<1-N> on|off]æ’å…¥æˆ–æ‹”å‡ºç½‘çº¿  
                        [-nictrace<1-N> on|off] å¼€å¯æˆ–å…³é—­ç½‘ç»œè¿½è¸ª  
                        [-nictracefile<1-N> <filename>] å°†ç½‘ç»œæµé‡è¿½è¸ªæ•°æ®ä¿å­˜åˆ°æ–‡ä»¶  
                        [-nicspeed<1-N> <kbps>] è®¾ç½®ç½‘ç»œè¿æ¥çš„é€Ÿåº¦  
                        [-hostifdev<1-N> none| ä¸è¿æ¥åˆ°ä¸»æœºç½‘ç»œæ¥å£  
                                 <devicename>] æ¡¥æ¥æ¨¡å¼ä¸‹è¿æ¥åˆ°æŒ‡å®šçš„ä¸»æœºæ¥å£  
                        [-intnet<1-N> <network name>] å†…ç½‘æ¨¡å¼ä¸‹ä¸ºè™šæ‹ŸæœºæŒ‡å®šå†…éƒ¨ç½‘ç»œåç§°  
                        [-natnet<1-N> <network>| é…ç½®NATç½‘ç»œæ¥å£çš„åœ°å€  
                                        default] é»˜è®¤NATç½‘ç»œæ¥å£çš„åœ°å€æ˜¯10.0.x.0/24  
                        [-macaddress<1-N> auto| è‡ªåŠ¨ç”Ÿæˆè™šæ‹Ÿç½‘å¡çš„MACåœ°å€  
                                         <mac>] æŒ‡å®šè™šæ‹Ÿç½‘å¡çš„MACåœ°å€  
                        [-uart<1-N> off| ä¸å¯ç”¨è™šæ‹Ÿä¸²å£  
                        <I/O base> <IRQ>]å¯ç”¨è™šæ‹Ÿä¸²å£ï¼Œå¹¶è®¾ç½®è™šæ‹Ÿä¸²å£çš„I/Oå‚æ•°å’ŒIRQå‚æ•°  
                        [-uartmode<1-N> disconnected| å¯ç”¨è™šæ‹Ÿä¸²å£ï¼Œä½†ä¸è¿æ¥åˆ°å®¿ä¸»æœºçš„ä¸²å£  
                                       server <pipe>| åœ¨å®¿ä¸»æœºåˆ›å»ºPIPEé€šé“ï¼Œå¹¶å°†è™šæ‹Ÿæœºä¸²å£è¿æ¥åˆ°è¿™ä¸ªé€šé“  
                                       client <pipe>| ä¸åˆ›å»ºPIPEé€šé“ï¼Œè€Œæ˜¯å°†è™šæ‹Ÿæœºä¸²å£è¿æ¥åˆ°å·²å­˜åœ¨çš„é€šé“  
                                       <devicename>] å°†è™šæ‹Ÿæœºä¸²å£è¿æ¥åˆ°å®¿ä¸»æœºçš„ä¸²å£  
                        [-gueststatisticsinterval <seconds>] é…ç½®è™šæ‹Ÿæœºé™æ€æ—¶é—´é—´éš”  
                        [-audio none| è™šæ‹Ÿæœºä¸è¿æ¥å£°å¡  
                                null| å°†è™šæ‹Ÿæœºçš„å£°å¡è¿æ¥åˆ°ç©ºçš„å£°éŸ³è®¾å¤‡  
                              dsound] å°†è™šæ‹Ÿæœºçš„å£°å¡è¿æ¥åˆ°å®¿ä¸»æœºçš„å£°å¡  
                        [-audiocontroller ac97| å°†è™šæ‹Ÿæœºå£°å¡è™šæ‹Ÿä¸ºICH AC97å£°å¡  
                                          sb16] å°†è™šæ‹Ÿæœºå£°å¡è™šæ‹Ÿä¸ºsoundblaster 16å£°å¡  
                        [-clipboard disabled| ä¸å…±äº«å‰ªè´´æ¿  
                                 hosttoguest| å°†å®¿ä¸»æœºçš„å‰ªè´´æ¿å…±äº«ç»™è™šæ‹Ÿæœº  
                                 guesttohost| å°†è™šæ‹Ÿæœºçš„å‰ªè´´æ¿å…±äº«ç»™å®¿ä¸»æœº  
                               bidirectional] å®¿ä¸»æœºå’Œè™šæ‹Ÿæœºå…±ä½¿ç”¨ä¸€ä¸ªå‰ªè´´æ¿  
                        [-vrdp on|off] å¼€å¯|å…³é—­virtualboxå†…ç½®çš„VRDPæœåŠ¡å™¨  
                        [-vrdpport default| ä½¿ç”¨é»˜è®¤çš„vrdpç«¯å£3389  
                                    <port>] æŒ‡å®švrdpç«¯å£  
                        [-vrdpaddress <host>] æŒ‡å®šVRDPä¸»æœºåœ°å€  
                        [-vrdpauthtype null| ä¸ç”¨æˆæƒï¼Œä»»ä½•å®¢æˆ·æœºéƒ½å¯ä»¥è¿æ¥åˆ°VRDPæœåŠ¡å™¨  
                                   external| åªæœ‰å®¿ä¸»æœºçš„ç”¨æˆ·æ‰å¯ä»¥è¿æ¥åˆ°VRDPæœåŠ¡å™¨  
                                      guest] åªæœ‰è™šæ‹Ÿæœºçš„ç”¨æˆ·æ‰å¯ä»¥è¿æ¥åˆ°VRDPæœåŠ¡å™¨  
                        [-vrdpmulticon on|off] æ‰“å¼€|å…³é—­VRDPå¤šç”¨æˆ·è¿æ¥æ¨¡å¼  
                        [-vrdpreusecon on|off] æ‰“å¼€|å…³é—­VRDPæ–­çº¿é‡è¿  
                        [-usb on|off] æ‰“å¼€|å…³é—­è™šæ‹ŸUSBæ§åˆ¶å™¨  
                        [-usbehci on|off] æ‰“å¼€|å…³é—­è™šæ‹ŸUSB2.0æ§åˆ¶å™¨  
                        [-snapshotfolder default| å°†ç³»ç»Ÿå¿«ç…§ä¿å­˜åˆ°é»˜è®¤æ–‡ä»¶å¤¹  
                                          <path>] å°†ç³»ç»Ÿå¿«ç…§ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶å¤¹  
VBoxManage startvm      <uuid>|<name> å¼€å¯æŒ‡å®šUUID|åç§°çš„è™šæ‹Ÿæœº  
                        [-type gui|vrdp] è®¾ç½®è™šæ‹Ÿæœºæ ‡å‡†æ˜¾ç¤ºè®¾å¤‡GUIç•Œé¢|VRDP  
VBoxManage controlvm    <uuid>|<name> æ”¹å˜æ­£åœ¨è¿è¡Œçš„è™šæ‹Ÿæœºçš„çŠ¶æ€  
                         pause| æš‚åœï¼Œè¿™æ—¶è™šæ‹Ÿæœºçª—å£æ˜¾ç¤ºç°è‰²  
                        resume| æ¢å¤æš‚åœçš„è™šæ‹Ÿæœº  
                         reset| å¤ä½  
                      poweroff| å¼ºè¡Œå…³é—­  
               acpipowerbutton| å…³æœº  
               acpisleepbutton| ä½¿è™šæ‹Ÿæœºå¤„äºç¡çœ çŠ¶æ€  
                     savestate| ä¿å­˜çŠ¶æ€ç„¶åå…³é—­ï¼Œç›¸å½“äºä¼‘çœ   
           keyboardputscancode <hex> [<hex> ...] é”®ç›˜æ‰«æç è®¾ç½®  
               setlinkstate<1-4> on|off è¿æ¥|æ–­å¼€ç½‘ç»œè¿æ¥  
               usbattach <uuid>|<address> è¿æ¥åˆ°æŒ‡å®šUUDI|åœ°å€çš„USBè®¾å¤‡   
               usbdetach <uuid>|<address> æ–­å¼€æŒ‡å®šUUDI|åœ°å€çš„USBè®¾å¤‡     
               dvdattach none| ä¸è¿æ¥è™šæ‹ŸDVDå…‰é©±  
                       <uuid>| è¿æ¥åˆ°æŒ‡å®šUUIDçš„DVDå…‰é©±  
                   <filename>| è¿æ¥åˆ°æŒ‡å®šåç§°çš„DVDæ˜ åƒæ–‡ä»¶  
                  host:<drive> è¿æ¥åˆ°å®¿ä¸»æœºçš„DVDå…‰é©±  
               floppyattach none| ä¸è¿æ¥è™šæ‹Ÿè½¯é©±  
                          <uuid>| è¿æ¥åˆ°æŒ‡å®šUUIDçš„è™šæ‹Ÿè½¯é©±  
                      <filename>| è¿æ¥åˆ°æŒ‡å®šåç§°çš„è½¯ç›˜æ˜ åƒæ–‡ä»¶  
                     host:<drive> è¿æ¥åˆ°å®¿ä¸»æœºçš„è½¯é©±  
               setvideomodehint <xres> è®¾ç½®è™šæ‹Ÿæœºçš„å±å¹•åˆ†è¾¨ç‡ æ°´å¹³åƒç´   
                                <yres> å‚ç›´åƒç´   
                                 <bpp> é¢œè‰²æ·±åº¦  
                             [display] åˆ·æ–°é¢‘ç‡  
               setcredentials <username> æŒ‡å®šVRDPè‡ªåŠ¨è¿æ¥å‚æ•° ç”¨æˆ·å  
                              <password> å¯†ç   
                                <domain> åŸŸ  
             [-allowlocallogon <yes|no>] å…è®¸|ç¦æ­¢æœ¬åœ°ç™»é™†  
VBoxManage discardstate     <uuid>|<name> ä¸¢å¼ƒæŒ‡å®šUUID|åç§°çš„è™šæ‹Ÿæœºçš„ä¿å­˜çŠ¶æ€  
VBoxManage adoptstate       <uuid>|<name> <state_file> å°†è™šæ‹Ÿæœºä»æŒ‡å®šçš„ä¿å­˜çŠ¶æ€ä¸­æ¢å¤  
VBoxManage snapshot         <uuid>|<name> ä¸ºæŒ‡å®šçš„è™šæ‹Ÿæœºæ‹å¿«ç…§  
                            take <name> ä¸ºå¿«ç…§å–å  
                        [-desc <desc>]| ç»™å¿«ç…§æ·»åŠ æè¿°  
                        discard <uuid>|<name> | ä¸¢å¼ƒæŒ‡å®šçš„å¿«ç…§   
                        discardcurrent -state| æ¢å¤åˆ°æœ€è¿‘çš„å¿«ç…§  
                                        -all | æ¢å¤åˆ°å€’æ•°ç¬¬äºŒä¸ªå¿«ç…§  
                        edit <uuid>|<name>| ç¼–è¾‘æŒ‡å®šçš„å¿«ç…§  
                                   -current ç¼–è¾‘å½“å‰å¿«ç…§  
                          [-newname <name>] ä¿®æ”¹å¿«ç…§åç§°  
                          [-newdesc <desc>] ä¿®æ”¹å¿«ç…§æè¿°  
                        showvminfo <uuid>|<name> æ˜¾ç¤ºå¿«ç…§çš„è™šæ‹Ÿæœºä¿¡æ¯  
VBoxManage registerimage    disk|dvd|floppy <filename> æ³¨å†Œç¡¬ç›˜ã€å…‰ç›˜ã€è½¯ç›˜æ˜ åƒæ–‡ä»¶  
                            [-type normal| æ³¨å†Œä¸ºæ™®é€šç±»å‹ï¼ˆå¯åˆ›å»ºå¿«ç…§ï¼Œå¯è¯»å†™ï¼‰  
                                immutable| æ³¨å†Œä¸ºåªè¯»ç±»å‹ï¼ˆç›¸å½“äºåŠ äº†ç¡¬ç›˜å¡ï¼‰  
                             writethrough] æ³¨å†Œä¸ºå¯å†™ç±»å‹ï¼ˆè¿™ç§ç±»å‹ä¸èƒ½åˆ›å»ºå¿«ç…§ï¼‰  
                               (disk only) (æ³¨å†Œç±»å‹é€‰é¡¹åªé€‚ç”¨äºç¡¬ç›˜ï¼‰  
VBoxManage unregisterimage disk| ä»è™šæ‹Ÿä»‹è´¨ç®¡ç†å™¨åˆ é™¤æŒ‡å®šçš„ç¡¬ç›˜  
                             dvd| ä»è™šæ‹Ÿä»‹è´¨ç®¡ç†å™¨åˆ é™¤æŒ‡å®šçš„DVDå…‰ç›˜   
                           floppy ä»è™šæ‹Ÿä»‹è´¨ç®¡ç†å™¨åˆ é™¤æŒ‡å®šçš„è½¯ç›˜  
                          <uuid>| åˆ é™¤æ—¶æŒ‡å®šUUID  
                       <filename> åˆ é™¤æ—¶æŒ‡å®šæ˜ åƒæ–‡ä»¶  
VBoxManage showvdiinfo      <uuid>|<filename> æ˜¾ç¤ºæŒ‡å®šUUID|åç§°è™šæ‹Ÿç¡¬ç›˜çš„ä¿¡æ¯  
  
VBoxManage createvdi        -filename <filename> åˆ›å»ºæŒ‡å®šåç§°çš„è™šæ‹Ÿç¡¬ç›˜  
                            -size <megabytes> æŒ‡å®šè™šæ‹Ÿç¡¬ç›˜çš„å¤§å°ï¼ˆä»¥å…†ä¸ºå•ä½ï¼‰  
                            [-static] åˆ›å»ºå›ºå®šå¤§å°çš„è™šæ‹Ÿç¡¬ç›˜  
                            [-comment <comment>] æ·»åŠ ä¸€æ®µè§£é‡Šæ€§æ–‡å­—  
                            [-register] æ³¨å†Œæ–°åˆ›å»ºçš„è™šæ‹Ÿç¡¬ç›˜  
                            [-type normal| æ³¨å†Œç±»å‹ æ™®é€šï¼ˆå¯ä»¥åˆ›å»ºå¿«ç…§ï¼‰  
                             writethrough] æ³¨å†Œç±»å‹ å¯å†™ï¼ˆä¸èƒ½åˆ›å»ºå¿«ç…§ï¼‰  
                          (default: normal) é»˜è®¤æ˜¯æ™®é€šç±»å‹  
VBoxManage modifyvdi        <uuid>|<filename> compact å‹ç¼©æŒ‡å®šçš„è™šæ‹Ÿç¡¬ç›˜  
VBoxManage clonevdi         <uuid>|<filename> <outputfile> å…‹éš†æŒ‡å®šçš„VDIè™šæ‹Ÿç¡¬ç›˜  
VBoxManage convertdd        [-static] <filename> <outputfile> å°†rawç¡¬ç›˜è½¬æ¢æˆvdiè™šæ‹Ÿç¡¬ç›˜  
VBoxManage convertdd        [-static] stdin <outputfile> <bytes> å°†æ ‡å‡†è¾“å…¥å‚æ•°æŒ‡å®šçš„è®¾å¤‡è½¬æ¢æˆvdiè™šæ‹Ÿç¡¬ç›˜ï¼Œæ¯”å¦‚ï¼šdd if=/dev/sda1 | VBoxManage convertdd stdin /media/disk/C.vdi 62277025792  

#+END_SRC

* centos7 basic environment
  centos7 download
  http://isoredirect.centos.org/centos/7/isos/x86_64/CentOS-7-x86_64-Minimal-1708.iso

** lvm 
   åœ¨æ–‡ä»¶ä¸­æ·»åŠ è¦æŒ‚è½½çš„åˆ†åŒºå’Œæ–‡ä»¶ç›®å½•å¯ä»¥ä¿®æ”¹æ–‡ä»¶
   
   /etc/fstab

   /dev/sda5/    media/win    ntfs    defaults   02

   ç„¶å mount -a

   1. æŸ¥çœ‹å‡ å—ç¡¬ç›˜
   
      sudo fdisk -l |grep sd
   
   2. åˆ›å»ºåˆ†åŒº
   
      è™šæ‹Ÿæœºç°æœ‰20gçš„ç¡¬ç›˜,ä½¿ç”¨fdiskåˆ’åˆ†ç£ç›˜
       
      sudo fdisk /dev/sda
   
      #+BEGIN_VERSE
         m  å¸®åŠ©ä¿¡æ¯  
         n åˆ›å»ºåˆ†åŒº
         e æ‰©å±•åˆ†åŒº    +5G  pppp/pppe
         p æ‰“å°åˆ†åŒº
         t åˆ†åŒºç±»å‹ L  (lvm)
         w å†™å…¥ä¿å­˜åˆ†åŒº
      #+END_VERSE

   3. æ ¼å¼åŒ– åˆ†åŒº

   - LVM
     pv --> vg --> lv
     å‚è€ƒ:
     http://blog.sina.com.cn/s/blog_b77735d20101e5cn.html
     http://aurthurxlc.github.io/Aurthur-2017/Centos-7-extend-lvm-volume.html

     #+BEGIN_SRC 
     fdisk -l | grep sd
     fdisk /dev/sda
     partprobe
     pvdisplay
     pvcreate /dev/sda3
     vgdisplay
     vgextend centos /dev/sda3
     lvdisplay
     #lvcreate -L 3.31G -n manue1 centos
     #mkfs.xfs /dev/centos/manue1
     #lvremove -f /dev/centos/manue1
     lvextend -l +100%FREE /dev/centos/root
     df -Th
     xfs_growfs /dev/centos/root
     #+END_SRC
** ip
  * è”ç½‘æ–¹å¼: é…ç½®ä¸‰å¼ ç½‘å¡
    virtualBox ä¸­ NAT å’Œ Host-only ä¸¤ç§æ¨¡å¼ä¸èƒ½åŒæ—¶å¹¶å­˜ï¼Œæµ‹è¯•åªèƒ½è”ç½‘çš„æ—¶å€™å…³æ‰å¦ä¸€å¼ ç½‘å¡
    1. NAT 
      ç½‘å¡1 ç”¨æ¥è¿æ¥å¤–ç½‘ 
    2. Host-only
      ç”¨æ¥é…ç½®é™æ€IP é…ç½®é›†ç¾¤æœåŠ¡çš„æ—¶å€™ä¸éœ€è¦ä¿®æ”¹IP
      vi /etc/sysconfig/network-scripts/  
       #+BEGIN_SRC 
         #static assignment
         ONBOOT=yes
         BOOTPROTO=static
         IPADDR=192.168.56.10
         NETMASK=255.255.255.0
         GATEWAY=192.168.56.1
       #+END_SRC
    3. Bridge
      vbox è‡ªåŠ¨é…ç½®IPï¼Œä¹Ÿå¾ˆæ–¹ä¾¿ 
       
    è¿™è¾¹æ‰“ç®—ä½¿ç”¨ç½‘å¡1 natæ¨¡å¼è¿æ¥å¤–ç½‘ï¼Œç½‘å¡3çš„æ¡¥æ¥æ¨¡å¼ä¸å±€åŸŸç½‘å†…å…¶ä»–ä¸»æœºé€šä¿¡,ç½‘å¡äºŒçš„ä¸»æœºæ¨¡å¼æ­å»ºé›†ç¾¤

    æ³¨æ„ï¼š ç½‘å¡äºŒå’Œç½‘å¡ä¸‰çš„ gateway å­—æ®µè¦æ³¨é‡Šæ‰
    
  * ip tool

    Ip  [é€‰é¡¹]  æ“ä½œå¯¹è±¡{link|addr|route...}
    
    # ip link show                           # æ˜¾ç¤ºç½‘ç»œæ¥å£ä¿¡æ¯
    
    # ip link set eth0 up                   # å¼€å¯ç½‘å¡
    
    # ip link set eth0 down                  # å…³é—­ç½‘å¡
    
    # ip link set eth0 promisc on            # å¼€å¯ç½‘å¡çš„æ··åˆæ¨¡å¼
    
    # ip link set eth0 promisc offi          # å…³é—­ç½‘å¡çš„æ··ä¸ªæ¨¡å¼
    
    # ip link set eth0 txqueuelen 1200       # è®¾ç½®ç½‘å¡é˜Ÿåˆ—é•¿åº¦
    
    # ip link set eth0 mtu 1400              # è®¾ç½®ç½‘å¡æœ€å¤§ä¼ è¾“å•å…ƒ
    
    # ip addr show                           # æ˜¾ç¤ºç½‘å¡IPä¿¡æ¯
    
    # ip addr add 192.168.0.1/24 dev eth0    # è®¾ç½®eth0ç½‘å¡IPåœ°å€192.168.0.1
    
    # ip addr del 192.168.0.1/24 dev eth0    # åˆ é™¤eth0ç½‘å¡IPåœ°å€
    
    # ------
    
    # ip route list                                            # æŸ¥çœ‹è·¯ç”±ä¿¡æ¯
    
    # ip route add 192.168.4.0/24  via  192.168.0.254 dev eth0 # è®¾ç½®192.168.4.0ç½‘æ®µçš„ç½‘å…³ä¸º192.168.0.254,æ•°æ®èµ°eth0æ¥å£
    
    # ip route add default via  192.168.0.254  dev eth0        # è®¾ç½®é»˜è®¤ç½‘å…³ä¸º192.168.0.254
    
    # ip route del 192.168.4.0/24                              # åˆ é™¤192.168.4.0ç½‘æ®µçš„ç½‘å…³
    
    # ip route del default                                     # åˆ é™¤é»˜è®¤è·¯ç”±
      
    sudo service network restart
    
** sshd
  ssh è¿æ¥å¼‚å¸¸æ…¢
  sudo vi /etc/ssh/sshd_config

  #+BEGIN_SRC 
  UseDNS no
  #+END_SRC

** hostname
  æ°¸ä¹…ä¿®æ”¹ä¸»æœºåå­—
  sudo hostnamectl --static set-hostname master

  sudo vi /etc/hosts

  [manue1@localhost ~]$ cat /etc/hostname
   master
  [manue1@localhost ~]$ cat /etc/hosts
   127.0.0.1 master
   ::1 master
** yum source

  sudo yum -y install wget
  
  - å¤‡ä»½
    sudo mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup

  - è®¾ç½®aliyun source
    sudo wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

  - è®¾ç½®EPLEPEL source
    
    sudo wget -P /etc/yum.repos.d/ http://mirrors.aliyun.com/repo/epel-7.repo

    æ·»åŠ åå¯ä»¥åƒfedoraä¸Š yum install packname

  - æ¸…ç†ç¼“å­˜å¹¶ç”Ÿæˆæ–°çš„ç¼“å­˜

    sudo yum clean all  
    sudo yum makecache  

** ntp

   | master  | server |  
   |---------+--------+
   | slave01 | client |  
   | slave02 | client |

  - any nodes

    sudo yum -y install ntp
    
    timedatectl set-timezone Asia/Shanghai   # è®¾ç½®ä¸Šæµ·æ—¶åŒº
   
   - server configural
     
     systemctl start ntpd
      
     systemctl enable ntpd

     vi /etc/ntp.conf 
     
     #+BEGIN_SRC 
     
restrict 192.168.56.0 mask 255.255.0.0

server 127.127.1.0

fudge 127.127.1.0 stratum 10
     #+END_SRC
     
     systemctl restart ntpd

   - client configural
     
     systemctl start ntpd
     
     systemctl enable ntpd

     vi /etc/ntp.conf
     
     #+BEGIN_SRC 
server 192.168.56.10
     
     #+END_SRC

    netstat -anp | grep 123

** firewallds
  
  - æŸ¥çœ‹çŠ¶æ€
    systemctl status firewalld
  - å…³é—­
    systemctl stop firewalld
  - ç¦ç”¨
    systemctl disable firewalld
** disable selinux
  ä¸€æ¬¾ä¸ºäº†æé«˜ç³»ç»Ÿå®‰å…¨æ€§çš„è½¯ä»¶ï¼šå¯¹ç³»ç»ŸæœåŠ¡ï¼Œæ–‡ä»¶æƒé™ï¼Œç½‘ç»œç«¯å£è®¿é—®æœ‰æå…¶ä¸¥æ ¼çš„é™åˆ¶ï¼Œ
  ä¾‹å¦‚ï¼šå¦‚æœå¯¹ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰æ­£ç¡®å®‰å…¨ä¸Šä¸‹æ–‡é…ç½®ï¼Œ ç”šè‡³ä½ æ˜¯rootç”¨æˆ·ï¼Œä½ ä¹Ÿä¸èƒ½å¯åŠ¨æŸæœåŠ¡

  sudo vi /etc/sysconfig/selinux
   selinux = disable
** java  & scala
  åŸºç¡€ç¯å¢ƒç”¨root é…ç½®åœ¨/etc/profile è‡ªå¯åŠ¨ç¯å¢ƒæ–‡ä»¶å†…
  refer : https://www.mtyun.com/library/how-to-setup-scala-on-centos7
  - java rpm install

    1. download
       http://www.oracle.com/technetwork/java/javase/downloads/index.html
    2. install
       sudo rpm -ivh jdk-8u144-linux-x64.rpm
       sudo rpm -aq | grep jdk
       
       sudo rpm -e jdk   æ— æ•ˆ
       sudo yum remove jdk  
       
       sudo vi /etc/profile
       #+BEGIN_SRC 
         #JAVA_HOME
         export JAVA_HOME=/usr/java/jdk1.8.0_144
         export CLASSPATH=.:$JAVA_HOME/jre/lib/rt.jar:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
         export PATH=$PATH:$JAVA_HOME/bin
       #+END_SRC
  - java ç¦»çº¿åŒ…å®‰è£…

    tar -zxvf jdk-8u151-linux-x64.tar.gz

    vi /etc/profile
    #+BEGIN_SRC 
#JAVA_HOME
JAVA_HOME=/home/manue1/opt/jdk8
PATH=$PATH:$JAVA_HOME/bin
export JAVA_HOME PATH
    #+END_SRC
  - scala ç¦»çº¿åŒ…å®‰è£…
    å½“å‰æœ€æ–°ç‰ˆæœ¬
    tar zxvf scala-2.11.7.tgz

    #+BEGIN_SRC 
    SCALA_HOME=/home/manue1/opt/scala-2.11.7
    PATH=$PATH:$SCALA_HOME/bin
    export SCALA_HOME PATH
    #+END_SRC
    
* hadoop é›†ç¾¤é…ç½®
** hadoop hbase spark ç‰ˆæœ¬é€‰æ‹©
   + hbase æ”¯æŒ hadoop ç‰ˆæœ¬å¯¹ç…§è¡¨
   
      The 1.2.x series is the current stable release line
     
      http://www-us.apache.org/dist/hbase/
     
      ä¸‹é¢æŸ¥çœ‹1.2.x éœ€è¦çš„hadoopç‰ˆæœ¬
   
      http://hbase.apache.org/book.html#arch.overview
   
      crtl + F  "s" æœç´¢é¡µé¢
   
     é€‰æ‹© Hadoop-2.7.1+
     
   + spark æ”¯æŒ hadoop
     
     http://spark.apache.org/downloads.html
     
     å®˜æ–¹ä¸‹è½½é¡µé¢å¯ä»¥æ‰‹åŠ¨é€‰æ‹©
   
   + hive æ”¯æŒ hadoop
     
     https://hive.apache.org/downloads.html
   
     ç¨³å®šç‰ˆä¸‹è½½åœ°å€
     
     http://mirrors.shuosc.org/apache/hive/stable-2/
   
   + zookeeper
       
       ä¸‹è½½ç¨³å®šç‰ˆå³å¯
       
       http://mirrors.shuosc.org/apache/zookeeper/stable/

** ç¯å¢ƒå‡†å¤‡
   ä¸‰å°vbox è™šæ‹Ÿcentos7 é…ç½® java scala ç¯å¢ƒ å…³é—­é˜²ç«å¢™å’Œselinux
   
   - cluster
     | hostname |            ip |
     |----------+---------------|
     | master   | 192.168.56.10 |
     |----------+---------------|
     | slave01  | 192.168.56.11 |
     |----------+---------------|
     | slave02  | 192.168.56.12 |
     |----------+---------------|

   - disable ipv6

     sudo vi /etc/sysctl.conf
     
     æ·»åŠ ä¸‹é¢å†…å®¹
     
     #+BEGIN_SRC 

# disable ipv6
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
     
     #+END_SRC

     è§£å†³master:50070 é¡µé¢æ‰¾ä¸åˆ°live node 

     è§£å†³ connection exception
     
     #+BEGIN_SRC 
17//23 23:19:48 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
ls:all From slave01/127.0.0.1 to master:9000 failed on connection exception: java.net.ConnectException: æ‹’ç»è¿æ¥; For more details see:  http://wiki.apache.org/hadoop/ConnectionRefused
     
     #+END_SRC

   - hostname & host
     ä¸‰å°ä¸»æœºéƒ½è¦
     ä¿®æ”¹ä¸»æœºå
     ä¿®æ”¹/etc/hosts äº’ç›¸æ·»åŠ hostnameè®¿é—®åˆ«å
     æ³¨æ„ï¼› #127.0.0.1 master è¿™æ ·çš„æ˜ å°„ä¸€å®šè¦æ³¨é‡Šæ‰,master:8088æ— æ³•è®¿é—®æœ€ç»ˆå®šä½åˆ°è¿™é‡Œäº†
     #+BEGIN_SRC 
#ceos7 cluster
19268.56.10 master
19268.56.11 slave01
19268.56.12 slave02
     #+END_SRC

   - å…ç™»å½•éªŒè¯
     ssh-keygen -t rsa
     ssh-copy-id -i ~/.ssh/id_rsa.pub manue1@slave01 
     ssh-copy-id -i ~/.ssh/id_rsa.pub manue1@slave02 
     ssh-copy-id -i ~/.ssh/id_rsa.pub manue1@master
     
   - download hadoop
       tar -zxvf hadoop-2.7.5.tar.gz
** é…ç½®hadoop cluster
     
    - hadoop_home
      ä¸‰å°èŠ‚ç‚¹éƒ½éœ€è¦é…ç½®
      vi .bashrc
      #+BEGIN_SRC 
# Hadoop Environment Variables
export HADOOP_HOME=/home/manue1/opt/hadoop-2.7.5
export HADOOP_INSTALL=$HADOOP_HOME
export HADOOP_MAPRED_HOME=$HADOOP_HOME
export HADOOP_COMMON_HOME=$HADOOP_HOME
export HADOOP_HDFS_HOME=$HADOOP_HOME
export YARN_HOME=$HADOOP_HOME
export HADOOP_COMMON_LIB_NATIVE_DIR=$HADOOP_HOME/lib/native
export PATH=$PATH:$HADOOP_HOME/sbin:$HADOOP_HOME/bin
export HADOOP_OPTS="$HADOOP_OPTS -Djava.library.path=$HADOOP_HOME/lib/native" #è§£å†³WARN util.NativeCodeLoader: Unable to load native-hadoop library
export CATALINA_BASE=$HADOOP_HOME/share/hadoop/httpfs/tomcat #æ”¯æŒhttpfs rest api
      
      #+END_SRC

    - master
      
      /home/manue1/opt/hadoop-2.7.5/etc/hadoop/ ä¸‹6ä¸ªé…ç½®æ–‡ä»¶
      1. core-site.xml

         #+BEGIN_SRC 
<configuration>
    <!-- æŒ‡å®šHDFSè€å¤§ï¼ˆnamenodeï¼‰çš„é€šä¿¡åœ°å€ -->
    <property>
        <name>fs.defaultFS</name>
        <value>hdfs://master:9000</value>
    </property>
    <!-- æŒ‡å®šhadoopè¿è¡Œæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ -->
    <property>
        <name>hadoop.tmp.dir</name>
        <value>file:/home/manue1/opt/hadoop-2.7.5/tmp</value>
    </property>
</configuration>
    <!--å¼€å¯httpfså®ç°ä¸€ç§åŒ¿åçš„æ–¹å¼ç™»é™†hdfsæ–‡ä»¶ç³»ç»Ÿ ç«¯å£14000
        manue1ç”¨æˆ·ä¸ºhdfsçš„è¶…çº§ç”¨æˆ· hiveå¯åŠ¨ç”¨æˆ·
    -->

    <property>
         <name>hadoop.proxyuser.manue1.hosts</name>
         <value>*</value>
    </property>
    <property>
        <name>hadoop.proxyuser.manue1.groups</name>
        <value>*</value>
    </property>

         
         #+END_SRC

      2. hdfs-site.xml
         
         #+BEGIN_SRC 
<configuration>
        <!-- è®¾ç½®namenodeçš„httpé€šè®¯åœ°å€ -->
        <property>
                <name>dfs.namenode.secondary.http-address</name>
                <value>master:50090</value>
        </property>
        <!-- è®¾ç½®hdfså‰¯æœ¬æ•°é‡ -->
        <property>
                <name>dfs.replication</name>
                <value>1</value>
        </property>
         <!-- è®¾ç½®namenodeå­˜æ”¾çš„è·¯å¾„ -->
        <property>
                <name>dfs.namenode.name.dir</name>
                <value>file:/home/manue1/opt/hadoop-2.7.5/tmp/dfs/name</value>
        </property>
         <!-- è®¾ç½®datanodeå­˜æ”¾çš„è·¯å¾„ -->
        <property>
                <name>dfs.datanode.data.dir</name>
                <value>file:/home/manue1/opt/hadoop-2.7.5/tmp/dfs/data</value>
        </property>
</configuration>

         
         #+END_SRC

      3. mapred-site.xml
         
         mv mapred-site.xml.template mapred-site.xml

         #+BEGIN_SRC 
<configuration>
        <!-- é€šçŸ¥æ¡†æ¶MRä½¿ç”¨YARN -->
        <property>
                <name>mapreduce.framework.name</name>
                <value>yarn</value>
        </property>
        <property>
                <name>mapreduce.jobhistory.address</name>
                <value>master:10020</value>
        </property>
        <property>
                <name>mapreduce.jobhistory.webapp.address</name>
                <value>master:19888</value>
        </property>
</configuration>
         
         #+END_SRC
         
      4. yarn-site.xml
         
         #+BEGIN_SRC 
<configuration>
 <!-- è®¾ç½® resourcemanager åœ¨å“ªä¸ªèŠ‚ç‚¹-->
<!-- Site specific YARN configuration properties -->
        <property>
                <name>yarn.resourcemanager.hostname</name>
                <value>master</value>
        </property>
         <!-- reducerå–æ•°æ®çš„æ–¹å¼æ˜¯mapreduce_shuffle -->
        <property>
                <name>yarn.nodemanager.aux-services</name>
                <value>mapreduce_shuffle</value>
        </property>
        <!--æ‰€æœ‰ä¸»æœºè®¿é—®yarnç®¡ç†ç•Œé¢-->
        <property> 
                <name>yarn.resourcemanager.webapp.address</name>
                <value>0.0.0.0:8088</value>
        </property>

</configuration>
         
         #+END_SRC

      5. slaves
         
         #+BEGIN_SRC 
slave01
slave02
         #+END_SRC

      6. hadoop-env.sh

         ä¿®æ”¹
         export JAVA_HOME=/home/manue1/opt/jdk8
         
    - slaves
      
      tar -zcvf hadoop-2.7.5_conf_finshed.tar.gz hadoop-2.7.5/

      scp hadoop-2.7.5_conf_finshed.tar.gz manue1@slave02:/home/manue1/opt/
** å¯åŠ¨hadoop
   hdfs namenode -format #ç¬¬ä¸€æ¬¡å¯åŠ¨è¦æ‰§è¡Œæ ¼å¼åŒ–ï¼Œä¹‹åå¯åŠ¨ä¸ç”¨æ‰§è¡Œè¿™ä¸ª
   start-dfs.sh
   start-yarn.sh
   mr-jobhistory-daemon.sh start historyserver  ??
   httpfs.sh start


   - master
       #+BEGIN_SRC 
manue1@master sbin]$ jps
2034 NameNode
2483 Jps
15754 Bootstrap  #httpfs
1652 ResourceManager
2188 SecondaryNameNode
2447 JobHistoryServer
       
       #+END_SRC
       
   - slaves
       #+BEGIN_SRC 
[manue1@slave01 hadoop]$ jps
1360 DataNode
1430 NodeManager
1516 Jps
       #+END_SRC

  hadoop clusterçŠ¶æ€å±•ç¤ºç•Œé¢ webhdfs
  http://master:50070/
  curl "http://master:50070/webhdfs/v1/?op=liststatus&user.name=manue1"
  
  httpfs rest api é…ç½®HAçš„æ—¶å€™æ‰¾ä¸åˆ°namenodeå¯ä»¥é‡‡ç”¨httpfs
  http://master:14000/
  curl "http://master:14000/webhdfs/v1/?op=liststatus&user.name=manue1"

  yarn ç®¡ç†ç•Œé¢
  http://master:8088

* elasticstk é›†ç¾¤
** elasticsearch-611
   
   1. ç¯å¢ƒå‡†å¤‡
        
     | hostname |            ip |            |
     |----------+---------------+------------|
     | master   | 192.168.56.10 | masternode |
     |----------+---------------+------------|
     | slave01  | 192.168.56.11 | datanode   |
     |----------+---------------+------------|
     | slave02  | 192.168.56.12 | datanode   |
      
     -  ç”Ÿäº§ç¯å¢ƒé…ç½®: 

        10èŠ‚ç‚¹ 6ä¸ªmasterå€™é€‰èŠ‚ç‚¹

        1èŠ‚ç‚¹ 4G + lucene 3G = 8G

        10Tç¡¬ç›˜ï¼Œæœ€å¤šå­˜5Tæ•°æ®

        4c + 8g + 1T * 10å° = 10T 
        4c + 16g + 2T * 5å° = 10T
        

    - java ç¯å¢ƒé…ç½®ï¼Œå…³é—­firewalld,ä¸»æœºåé…ç½®,å®˜ç½‘ä¸‹è½½elasticsearch-6.1.1.tar.gz

    - æ™®é€šç”¨æˆ·ä¸‹å®‰è£…es  username:manue1
      
    - ç³»ç»Ÿè®¾ç½®

      sudo -s åˆ‡æ¢åˆ°rootä¸‹æ‰§è¡Œ

      #+BEGIN_SRC 

sed -e '$a vm.max_map_count = 262144' -i /etc/sysctl.conf

sysctl -p

 

echo "ulimit -SHn 1048576" >> /etc/rc.local

sed -e '$a DefaultLimitCORE=infinity\nDefaultLimitNOFILE=1048576\nDefaultLimitNPROC=1048576' -i /etc/systemd/system.conf

cat >> /etc/security/limits.conf << EOF

 *           soft   nofile       1048576

 *           hard   nofile       1048576

 *           soft   nproc        1048576

 *           hard   nproc        1048576

EOF

sed -i 's/4096/1048576/' /etc/security/limits.d/20-nproc.conf

sed -e '/root       soft    nproc     unlimited/a\*           soft   nofile       1048576\n*           hard   nofile       1048576' -i /etc/security/limits.d/20-nproc.conf
      
      #+END_SRC
      ä¿®æ”¹ç³»ç»Ÿé…ç½®æ–‡ä»¶åï¼Œé‡å¯ç³»ç»Ÿç”Ÿæ•ˆ
      
   2. é…ç½®elasticsearch
      
     - elasticsearch.yml          # elsçš„é…ç½®æ–‡ä»¶
       #+BEGIN_SRC 
cluster.name: manue1-es-cluster  #é›†ç¾¤åç§°

node.name: master-node           #èŠ‚ç‚¹åç§°

node.data: false
node.master: true  #å»ºè®®ç›´æ¥ä¸è®¾ç½®ï¼Œé»˜è®¤ä¸¤ä¸ªéƒ½ä¸ºtrue.

path.data: /Home/Manue1/Opt/Elasticsearch-6.1.1/Els/Data  #æ•°æ®å­˜å‚¨ç›®å½•

path.logs: /home/manue1/opt/elasticsearch-6.1.1/els/log   #æ—¥å¿—å­˜å‚¨ç›®å½•

network.bind_host: 0.0.0.0   #í ½masterèŠ‚ç‚¹é…ç½® â€0.0.0.0â€ï¼Œå…è®¸æ‰€æœ‰ç½‘ç»œæ¥å£è®¿é—®
network.publish_host: master # é›†ç¾¤é€šä¿¡

gateway.recover_after_nodes: 3  #å€¼ä¸ºnï¼Œç½‘å…³æ§åˆ¶åœ¨nä¸ªèŠ‚ç‚¹å¯åŠ¨ä¹‹åæ‰æ¢å¤æ•´ä¸ªé›†ç¾¤, 3èŠ‚>ç‚¹å¯åŠ¨å1åˆ†é’Ÿ
gateway.recover_after_time: 1m

indices.recovery.max_bytes_per_sec: 20mb  #æ¢å¤æ•°æ®æ—¶,é™åˆ¶çš„å®½å¸¦æµé‡,å¦‚æœæ˜¯0å°±æ˜¯æ— é™åˆ¶

node.max_local_storage_nodes: 1                  #å€¼ä¸ºnï¼Œä¸€ä¸ªç³»ç»Ÿä¸­æœ€å¤šå¯ç”¨èŠ‚ç‚¹ä¸ªæ•°ä¸ºn

http.port: 9200                 # å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£ï¼Œ9300ä¸ºé›†ç¾¤æœåŠ¡çš„ç«¯å£


       #+END_SRC
       
     - jvm.options                # JVMç›¸å…³çš„é…ç½®ï¼Œå†…å­˜å¤§å°ç­‰ç­‰
       #+BEGIN_SRC 
      -Xms128M
      -Xmx128M

       -Xmx1gä¸-Xms1gJVMçš„æœ€å¤§æœ€å°å†…å­˜ã€‚å¦‚æœå¤ªå°ä¼šå¯¼è‡´Elasticsearchåˆšåˆšå¯åŠ¨å°±ç«‹åˆ»åœæ­¢ã€‚å¤ªå¤§ä¼šæ‹–æ…¢ç³»ç»Ÿæœ¬èº«
       #+END_SRC

     - log4j2.properties          # æ—¥å¿—ç³»ç»Ÿå®šä¹‰

     å°†é…ç½®å¥½çš„elasticsearch æ‰“åŒ…ä¼ åˆ°å„ä¸ªèŠ‚ç‚¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé…ç½®è¿‡ç¨‹ä¸­è¿è¡Œäº§ç”Ÿçš„data/nodes/0 æ–‡ä»¶
     ä¸€å®šè¦åˆ æ‰ï¼Œå†æ‰“åŒ…ä½¿ç”¨ï¼Œå¦åˆ™å„ä¸ªèŠ‚ç‚¹å¯åŠ¨æˆåŠŸäº†ï¼Œæ— æ³•åŠ å…¥åˆ°é›†ç¾¤ï¼ŒèŠ‚ç‚¹idå†²çª
      #+BEGIN_SRC 
      with the same id but is a different node instance
      #+END_SRC
      
   3. å¯åŠ¨elasticsearch
      
      su â€“ manue1

      vi  /home/manue1/opt/elasticsearch-6.1.1/bin/elasticsearch
      #+BEGIN_SRC 
ES_HEAP_SIZE=128m
MAX_OPEN_FILES=262144
      #+END_SRC
      
     nohup ./bin/elasticsearch -d 

     å…³é—­ ps -ef |grep elasticsearch|awk '{print $2}'|xargs kill -9

   4. refer
      https://blog.csdn.net/thomas0yang/article/details/55518105#%E5%86%85%E5%AD%98
      https://www.elastic.co/guide/cn/elasticsearch/guide/cn/important-configuration-changes.html#_%E6%9C%80%E5%B0%8F%E4%B8%BB%E8%8A%82%E7%82%B9%E6%95%B0
      https://zhuanlan.zhihu.com/p/35291900

** kibana

   é…ç½®åœ¨esçš„éæ•°æ®èŠ‚ç‚¹ä¸Š: 192.168.56.10

   ä¿®æ”¹ config/kibana.yml
   #+BEGIN_SRC 
server.host: "0.0.0.0" #ä¸åŒç½‘å¡ç½‘æ®µèƒ½å¤Ÿè®¿é—®
elasticsearch.url: "http://master:9200"
   #+END_SRC

   å¯åŠ¨ï¼š nohup  bin/kibana  &

   å…³é—­: ps -ef |grep kibana |awk '{print $2}'|xargs kill -9

   ss -lnp | grep 5601

** logstash
   1. download
      logstash-6.1.1.tar.gz
   2. config
      
      - åˆ›å»ºlogstash-conf ç›®å½•
        beatçš„é…ç½®æ–‡ä»¶
        vi beats.conf
        #+BEGIN_SRC 
input {
  beats {
    port => 5044
  }
}

# The filter part of this file is commented out to indicate that it is
# optional.
# filter {
#
# }

output {
  elasticsearch {
    hosts => "master:9200"
    manage_template => false
    index => "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}" 
  }
}
        
        #+END_SRC
        
      - jvm.options
        ä¿®æ”¹ xms xmx æœ€å¤§æœ€å°jvm ä¸º256M æ¯”esæµ‹è¯•é›†ç¾¤åƒå†…å­˜å¤š 

      - logstash.yml

   3. start logstash

     -  bin/logstash -e 'input { stdin { } } output { stdout {} }'
        æµ‹è¯•å¯åŠ¨

     - ./bin/logstash -f logstash-conf/beats.conf &
       
       é…ç½®æ–‡ä»¶å¯åŠ¨

       sudo netstat -anp | grep 5044
** beats
*** topbeat
    5.xç‰ˆæœ¬åå¼ƒç”¨äº†
    1. ä¸‹è½½
       topbeat-1.3.1-x86_64.tar.gz

    2. é…ç½®

      - topbeat

      - topbeat.template.json  
        topbeatè‡ªå¸¦çš„æ¨¡ç‰ˆï¼Œç”¨æ¥åˆ›å»ºå­˜æ”¾æ”¶é›†æ•°æ®çš„ç´¢å¼•ç»“æ„

      - topbeat.yml
        #+BEGIN_SRC 
input:
  period: 10           #é»˜è®¤10ç§’æ”¶é›†ä¸€æ¬¡
  procs: [".*"]   #å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥åŒ¹é…ä½ æ‰€è¦ç›‘æ§çš„è¿›ç¨‹ã€‚é»˜è®¤æ˜¯æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹éƒ½è¿›è¡Œç›‘æ§ã€‚
  stats:
    system: true
    proc: true
    filesystem: true
output:
  elasticsearch:
    hosts: ["master:9200"]
shipper:
logging:
  files:
        #+END_SRC
   

    3. eså¯¼å…¥æ¨¡ç‰ˆ
       å¯¼å…¥topbeatè‡ªå¸¦çš„æ¨¡ç‰ˆï¼Œç”¨æ¥åˆ›å»ºå­˜æ”¾æ”¶é›†æ•°æ®çš„ç´¢å¼•ç»“æ„

       - Configuring Template Loading - supported for Elasticsearch output only
         #+BEGIN_SRC 
         ERR Failed to perform any bulk index operations: 406 Not Acceptable
         é”™è¯¯åº”è¯¥æ˜¯æ¨¡ç‰ˆå’Œ6.0ç‰ˆæœ¬ä¸åŒ¹é…äº†ï¼Œå®˜ç½‘æ²¡æœ‰æ›´æ–°
         å†å»å®˜ç½‘æŸ¥çœ‹ï¼Œtopbeat ä»5.0 å·²ç»è¢« Metricbeatæ›¿æ¢äº†
         #+END_SRC

       - Loading the Template Manually - required for Logstash output


    4. kibana 

    5. å¯åŠ¨topbeatèŠ‚ç‚¹

       sudo ./topbeat -e -c topbeat.yml -d "publish"
*** filebeat
    1. download

       filebeat-6.1.1-linux-x86_64.tar.gz

       https://download.elastic.co/demos/logstash/gettingstarted/logstash-tutorial.log.gz
       logstash-tutorial.log.gz apache çš„æ—¥å¿—æ–‡ä»¶æ ·æœ¬

    2. config
       
       - filebeat.yml
         #+BEGIN_SRC 
- type: log
  # Change to true to enable this prospector configuration.
  enabled: true
  # Paths that should be crawled and fetched. Glob based paths.
  paths:
    - /var/log/*.log
    - /home/manue1/opt/source/*.log
    #- c:\programdata\elasticsearch\logs\*


output.logstash:
  # The Logstash hosts
  hosts: ["master:5044"]

         
setup.kibana:

  host: "master:5601"         

         #+END_SRC
         
       - modules
         
         sudo chown -R root /home/manue1/opt/filebeat-6.1.1-linux-x86_64/module

         sudo chown -R root /home/manue1/opt/filebeat-6.1.1-linux-x86_64/modules.d
         
         - Enable modules when you run Filebeatedit

           sudo ./filebeat -e --modules system,nginx,mysql  
         
           ./filebeat -e --modules nginx -M "nginx.access.var.paths=[/var/log/nginx/access.log*]"
           
         - filebeat.yml

           sudo ./filebeat modules list

           sudo ./filebeat modules enable system 

           #+BEGIN_SRC 
é»˜è®¤é…ç½®è¯»å–æ‰€æœ‰enable
filebeat.modules:
- module: nginx
- module: mysql
- module: system
           
           #+END_SRC

           

         

       - setup template
         
         for logstash manually setup
         #+BEGIN_SRC 
./filebeat setup --template -E output.logstash.enabled=false -E 'output.elasticsearch.hosts=["localhost:9200"]'
         #+END_SRC

       - setup kibana dashboards

         #+BEGIN_SRC 
         ./filebeat setup --dashboards
         #+END_SRC

       - start filebeat

         sudo chown root filebeat.yml 

         sudo -s

         nohup /home/manue1/opt/filebeat-6.1.1-linux-x86_64/filebeat -e -c /home/manue1/opt/filebeat-6.1.1-linux-x86_64/filebeat.yml -d "publish" &

         ps aux |grep beat

*** metricbeat
    
    1. download
       
       metricbeat-6.1.1-linux-x86_64.tar.gz
       
    2. conf
       
       - metricbeat.yml
         
        1. ä¿®æ”¹eså’Œkibanaçš„åœ°å€
           
           å¦‚æœè¾“å‡ºåˆ°logstashä¸­ï¼Œéœ€è¦å…³é—­ç›´æ¥å†™å…¥esï¼Œå¹¶é…ç½®logstashç›‘å¬5044ç«¯å£
           esä¹Ÿè¦æ‰‹åŠ¨åŠ è½½template
           #+BEGIN_SRC 
output.logstash:
  # The Logstash hosts
  hosts: ["master:5044"]
           #+END_SRC
        
        2. é…ç½®templateæ¨¡ç‰ˆ
           - Configure template loading
           - Load the template manually  
             required for Logstash output
             #+BEGIN_SRC 
             
             sudo ./metricbeat setup --template -E output.logstash.enabled=false -E 'output.elasticsearch.hosts=["master:9200"]'
             #+END_SRC

             
       - modules.d 
         ç›®å½•ä¸‹é¢å¯ä»¥é…ç½®å¤šç§æ¨¡å—
         ä¿®æ”¹ logstash.yml.disabled ä¸º logstash.yml å¯åŠ¨æ¨¡å—

       - kibana dashboard

         ./metricbeat setup --dashboards
         
    3. start 
       
       sudo chown root metricbeat.yml 
       sudo chown root modules.d/system.yml 
       sudo ./metricbeat -e -c metricbeat.yml -d "publish"

       ps aux |grep metricbeat


    å¤åˆ¶åˆ°ä¸åŒèŠ‚ç‚¹éƒ¨ç½²
*** packetbeat
    1. download 
       
       packetbeat-6.1.1-linux-x86_64.tar.gz

    2. config 
       
       - packetbeat.yml
         
         logstash & kibana åœ°å€ä¿®æ”¹

       - setup template
         
         ./packetbeat setup --template -E output.logstash.enabled=false -E 'output.elasticsearch.hosts=["master:9200"]'

       - set up kibana dashboard

         ./packetbeat setup --dashboards

    3. start beat
       
       sudo chown root packetbeat.yml 

       nohup /home/manue1/opt/packetbeat-6.1.1-linux-x86_64/packetbeat -e -c  /home/manue1/opt/packetbeat-6.1.1-linux-x86_64/packetbeat.yml -d "publish" &
       
* hive 
  
  hadoop namenodeä¸Šå®‰è£…,datanodeä¸Šæ— éœ€å®‰è£…
  
  1. download install

     hive

     http://mirrors.shuosc.org/apache/hive/stable-2/

     * mysql 
       
       refer: http://blog.csdn.net/Nemo____/article/details/72897455
       - remove mariadb
         rpm -qa|grep mariadb         //æŸ¥è¯¢å‡ºå·²å®‰è£…çš„mariadb
         rpm -e --nodeps æ–‡ä»¶å      //å¸è½½ ï¼Œ æ–‡ä»¶åä¸ºä½¿ç”¨rpm -qa|grep mariadb å‘½ä»¤æŸ¥å‡ºçš„æ‰€æœ‰æ–‡ä»¶
         sudo  rpm -e --nodeps mariadb-libscc
         
       - install mariadb

         https://www.cnblogs.com/starof/p/4680083.html 

         yum install mariadb-server mariadb

         systemctl start mariadb  #å¯åŠ¨MariaDB

         systemctl stop mariadb  #åœæ­¢MariaDB
         
         systemctl restart mariadb  #é‡å¯MariaDB
         
         systemctl enable mariadb  #è®¾ç½®å¼€æœºå¯åŠ¨

         mysql -uroot -p #NO PASSWORD

         set password for 'root'@'localhost' =password('manue1');  # set new password

         grant all privileges on *.* to root@'%'identified by 'manue1';  #è¿œç¨‹è¿æ¥è®¾ç½®

         vi /etc/my.cnf
         #+BEGIN_SRC 
 # set utf8
[mysql]
default-character-set=utf8  # NO SPACE
         #+END_SRC

  2. config

     https://cwiki.apache.org/confluence/display/Hive/GettingStarted
    
     http://blog.csdn.net/jssg_tzw/article/details/72354470

    - vi .bashrc
      #+BEGIN_SRC 
# Hive Environment Variables
export HIVE_HOME=/home/manue1/opt/apache-hive-2.3.2-bin
PATH=$JAVA_HOME/bin:$HADOOP_HOME/bin:$HBASE_HOME/bin:$HIVE_HOME/bin:$PATH
      #+END_SRC

    - metastore conf
      
      #+BEGIN_SRC 
mysql -h slave01 -uroot -p

insert into mysql.user (Host,User,Password)values('localhost','hive',password('manue1'));

create database hive;

grant all privileges on hive.* to hive@'%'identified by 'manue1'; 

flush privileges; 

      
      #+END_SRC

    - hive-site.xml
      
      mv hive-default.xml hive-site.xml
      
      1. hdfsæ–°å»ºç›®å½•
         #+BEGIN_SRC 
 <name>hive.metastore.warehouse.dir</name>
 <value>/user/hive/warehouse</value>
 <name>hive.exec.scratchdir</name>
<value>/tmp/hive</value>


 æ‰€ä»¥è¦åœ¨Hadoopé›†ç¾¤æ–°å»º/user/hive/warehouseç›®å½•ï¼Œæ‰§è¡Œå‘½ä»¤

[manue1@master conf]$ hadoop fs -mkdir -p /user/hive/warehouse
[manue1@master conf]$ hadoop fs -chmod -R 777 /user/hive/warehouse
[manue1@master conf]$ hadoop fs -mkdir -p /tmp/hive
[manue1@master conf]$ hadoop fs -chmod -R 777 /tmp/hive
      #+END_SRC

      2. mysqlç›¸å…³é…ç½®

         https://dev.mysql.com/downloads/connector/j/5.1.html download

         mv mysql-connector-java-5.1.45-bin.jar lib/

         #+BEGIN_SRC 

1. javax.jdo.option.ConnectionDriverNameï¼Œå°†è¯¥nameå¯¹åº”çš„valueä¿®æ”¹ä¸ºMySQLé©±åŠ¨ç±»è·¯å¾„ï¼š
<property
  <name>javax.jdo.option.ConnectionDriverName</name>
  <value>com.mysql.jdbc.Driver</value>
</property>  

2. javax.jdo.option.ConnectionURLï¼Œå°†è¯¥nameå¯¹åº”çš„valueä¿®æ”¹ä¸ºMySQLçš„åœ°å€ï¼š
 <name>javax.jdo.option.ConnectionURL</name>
 <value>jdbc:mysql://192.168.56.101:3306/hive?createDatabaseIfNotExist=true</value>

3.javax.jdo.option.ConnectionUserNameï¼Œå°†å¯¹åº”çš„valueä¿®æ”¹ä¸ºMySQLæ•°æ®åº“ç™»å½•åï¼š
<name>javax.jdo.option.ConnectionUserName</name>
<value>hive</value>

4.javax.jdo.option.ConnectionPasswordï¼Œå°†å¯¹åº”çš„valueä¿®æ”¹ä¸ºMySQLæ•°æ®åº“çš„ç™»å½•å¯†ç ï¼š
<name>javax.jdo.option.ConnectionPassword</name>
<value>*******</value>
      
      #+END_SRC

         å¯¹mysqlåˆå§‹åŒ–

         schematool -initSchema -dbType mysql

      3. æ›¿æ¢${system
         
         ${system:java.io.tmpdir}æ›¿æ¢ä¸ºhiveçš„ä¸´æ—¶ç›®å½•
         /home/manue1/opt/apache-hive-2.3.2-bin/iotmp

         ${system:user.name}éƒ½æ›¿æ¢ä¸ºmanue1

         #+BEGIN_SRC 
[manue1@master apache-hive-2.3.2-bin]$ mkdir iotmp
[manue1@master apache-hive-2.3.2-bin]$ sudo chmod -R 777 iotmp

:%s/${system:java.io.tmpdir}/\/home\/manue1\/opt\/apache-hive-2.3.2-bin\/iotmp/gg

:%s/${system:user.name}/manue1/gg
         #+END_SRC

    - hive-env.sh

      mv hive-env.sh.template hive-env.sh

      #+BEGIN_SRC 
export HADOOP_HOME=/home/manue1/opt/hadoop-2.7.5

export HIVE_CONF_DIR=/home/manue1/opt/apache-hive-2.3.2-bin/conf

export HIVE_AUX_JARS_PATH=/home/manue1/opt/apache-hive-2.3.2-bin/lib
      
      #+END_SRC
      
  3. start hive

     hive --service hiveserver2 &

     netstat -anp | grep 10000
     
     beeline æµ‹è¯•jdbcè¿æ¥

     beeline -u jdbc:hive2://master:10000 -n manue1 -p mmanue1

     #+BEGIN_SRC 

     bin/beeline
     !connect jdbc:hive2://master:10000
 hdfsæ”¯æŒçš„ç”¨æˆ· 
Enter username for jdbc:hive2://master:10000: manue1
Enter password for jdbc:hive2://master:10000: *****
     
     #+END_SRC

     #+BEGIN_SRC 

Connecting to jdbc:hive2://master:10000/default
18/01/10 20:37:17 [main]: WARN jdbc.HiveConnection: Failed to connect to master:10000
Error: Could not open client transport with JDBC Uri: jdbc:hive2://master:10000/default: Failed to open new session: java.lang.RuntimeException: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.security.authorize.AuthorizationException): User: manue1 is not allowed to impersonate anonymous (state=08S01,code=0)
Beeline version 2.3.2 by Apache Hive
beeline> 

åˆ†æ ï¼š è®¿é—®æƒé™é—®é¢˜

è§£å†³ ï¼šåœ¨hdfs çš„é…ç½®æ–‡ä»¶core-site.xmlä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œroot ä¸ºä½ç½®å¡«å…¥  User:*  ï¼Œetc   hadoop.proxyuser.eamon.hosts

<property>
  <name>hadoop.proxyuser.manue1.hosts</name>
  <value>*</value>
 </property>
 <property>
  <name>hadoop.proxyuser.manue1.groups</name>
  <value>*</value>
</property>
     

     #+END_SRC
* zookeeper
** Replicated ZooKeeper configural
   #+BEGIN_SRC 
note

For replicated mode, a minimum of three servers are required, and it is strongly recommended that you have an odd number of servers. If you only have two servers, then you are in a situation where if one of them fails, there are not enough machines to form a majority quorum. Two servers is inherently less stable than a single server, because there are two single points of failure.
     
  è‡³å°‘3èŠ‚ç‚¹,æ¯ä¸ªzookeeperæœåŠ¡éƒ½å¯ä»¥æˆä¸ºleaderï¼Œ followerï¼Œobserverã€‚
     #+END_SRC
   
   - vi conf/zoo.cfg

     sudo mkdir -p /var/lib/zookeeper
     sudo chown manue1:manue1  /var/lib/zookeeper/ #manue1 user start service
     åˆ›å»º vi /var/lib/zookeeper/myid å†…å®¹ä¸ºnode server.x ,å¦‚ masterä¸º1
     
     #+BEGIN_SRC 

tickTime=2000
dataDir=/var/lib/zookeeper
clientPort=2181
initLimit=5
syncLimit=2
server.1=master:2888:3888   #2888 é›†ç¾¤äº’ç›¸é€šä¿¡ 3888 leaderé€‰ä¸¾
server.2=slave01:2888:3888
server.3=slave02:2888:3888

# ï¼Œç«¯å£ 2181 ç”± ZooKeeper å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œç”¨äºè¿æ¥åˆ° ZooKeeper æœåŠ¡å™¨ï¼›ç«¯å£ 2888 ç”±å¯¹ç­‰ ZooKeeper æœåŠ¡å™¨ä½¿ç”¨ï¼Œç”¨äºäº’ç›¸é€šä¿¡ï¼›è€Œç«¯å£ 3888 ç”¨äºé¢†å¯¼è€…é€‰ä¸¾

     #+END_SRC
     scp -r zookeeper-3.4.10 manue1@slave01:/home/manue1/opt
     scp -r zookeeper-3.4.10 manue1@slave02:/home/manue1/opt

   - start service
     
     nohup /home/manue1/opt/zookeeper-3.4.10/bin/zkServer.sh restart

     ps -ef | grep zookeeper

     netstat -tnlpa | grep 2181 

     echo state | nc localhost 2181
* hbase
  start hadoop & zookeeper
** hbase configural
   - .bashrc

     #+BEGIN_SRC 
# Hbase Environment Variables
export HBASE_HOME=/home/manue1/opt/hbase-1.2.6/
PATH=$JAVA_HOME/bin:$HADOOP_HOME/bin:$HBASE_HOME/bin:$PATH


     
     #+END_SRC
     
   - hbase-env.sh
     #+BEGIN_SRC 
export JAVA_HOME=/home/manue1/opt/jdk8
export HBASE_MANAGES_ZK=false
     
     #+END_SRC

   - hbase-site.xml
     
   - regionservers
     #+BEGIN_SRC 
master
slave01
slave02
     #+END_SRC

     
** hbase start

 nohup /home/manue1/opt/hbase-1.2.6/bin/start-hbase.sh &

 nohup /home/manue1/opt/hbase-1.2.6/bin/stop-hbase.sh &


 http://master:16010/master-status
* kafka
** kafka configural
   
   - conf/server.properties

     #+BEGIN_SRC 
#æŒ‡å®šzookeeperçš„è¿æ¥ä¿¡æ¯
zookeeper.connect=master:2181,slave01:2181,slave02:2181

#æ¯ä¸ªbrokerç›¸å½“äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ³¨æ„å„ä¸ªèŠ‚ç‚¹çš„broker.idçš„å€¼å¿…é¡»å”¯ä¸€
broker.id=0

#brokerç›‘å¬ç«¯å£
listeners=PLAINTEXT://master:9092

log.dir=/var/log/kafka
     #+END_SRC
      sudo mkdir -p /var/log/kafka  
      sudo chown manue1:manue1 /var/log/kafka

     scp -r kafka_2.11-1.0.0/ manue1@slave01:/home/manue1/opt
     scp -r kafka_2.11-1.0.0/ manue1@slave02:/home/manue1/opt
     å„ä¸ªèŠ‚ç‚¹ä¿®æ”¹broker.id å’Œ listeners

** kafka start service


   - vi .bashrc
     #+BEGIN_SRC 
# KAFKA_HOME Environment Variables
export KAFKA_HOME=/home/manue1/opt/kafka_2.11-1.0.0
export PATH=$PATH:$KAFKA_HOME/bin
     
     #+END_SRC


   nohup  $KAFKA_HOME/bin/kafka-server-start.sh $KAFKA_HOME/config/server.properties &

   $KAFKA_HOME/bin/kafka-server-stop.sh
   #+BEGIN_SRC 

   è™šæ‹Ÿæœºç¯å¢ƒå†…å­˜ä¸å¤Ÿï¼Œé…ç½®å¯åŠ¨è„šæœ¬ jvm heap å¤§å° 

[manue1@slave01 config]$ $KAFKA_HOME/bin/kafka-server-start.sh $KAFKA_HOME/config/server.propertie
Java HotSpot(TM) 64-Bit Server VM warning: INFO: os::commit_memory(0x00000000c0000000, 1073741824, 0) failed; error='Cannot allocate memory' (errno=12)
   

vi kafka-server-start.sh

KAFKA_HEAP_OPTS="-Xmx256M -Xms128M
   #+END_SRC

   sudo netstat -anp | grep 9092
** use kafka

   http://blog.csdn.net/u010297957/article/details/72758765
   
   producer & consumer
   #+BEGIN_SRC 

[manue1@master ~]$ $KAFKA_HOME/bin/kafka-topics.sh --create --topic TestTopic001 --partitions 2 --replication-factor 1 --zookeeper master:2181,slave01:2181,slave02:2181
Created topic "TestTopic001".

[manue1@master ~]$ $KAFKA_HOME/bin/kafka-topics.sh --describe --topic TestTopic001 --zookeeper master:2181,slave01:2181,slave02:2181
Topic:TestTopic001	PartitionCount:2	ReplicationFactor:1	Configs:
	Topic: TestTopic001	Partition: 0	Leader: 1	Replicas: 1	Isr: 1
	Topic: TestTopic001	Partition: 1	Leader: 2	Replicas: 2	Isr: 2

[manue1@master logs]$ $KAFKA_HOME/bin/kafka-console-producer.sh --broker-list master:9092,slave01:9092,slave02:9092 --topic TestTopic001
>hi zbr
>what is your name
>i love zbr


[manue1@slave01 kafka_2.11-1.0.0]$ $KAFKA_HOME/bin/kafka-console-consumer.sh --from-beginning --topic TestTopic001 --zookeeper master:2181,slave01:2181,slave02:2181
Using the ConsoleConsumer with old consumer is deprecated and will be removed in a future major release. Consider using the new consumer by passing [bootstrap-server] instead of [zookeeper].
hi zbr
what is your name
i love zbr
   
   #+END_SRC
* spark
** spark configural

  https://data-flair.training/blogs/install-apache-spark-multi-node-cluster/


  - .bashrc
    #+BEGIN_SRC 
#SPARK_HOME Environment Variables
export SPARK_HOME=/home/manue1/opt/spark-2.2.1-bin-hadoop2.7
export PATH=$PATH:$SPARK_HOME/bin
    #+END_SRC


  - spark-env.sh

    cp spark-env.sh.template spark-env.sh

    #+BEGIN_SRC 
export JAVA_HOME=/home/manue1/opt/jdk8

export SCALA_HOME=/home/manue1/opt/scala-2.11.7

export HADOOP_HOME=/home/manue1/opt/hadoop-2.7.5

export HADOOP_CONF_DIR=/home/manue1/opt/hadoop-2.7.5/etc/hadoop

export SPARK_MASTER_IP=master

export SPARK_WORKER_MEMORY=64m

export SPARK_WORKER_CORES=1

export SPARK_WORKER_INSTANCES=2

å˜é‡è¯´æ˜
JAVA_HOMEï¼šJavaå®‰è£…ç›®å½•
SCALA_HOMEï¼šScalaå®‰è£…ç›®å½•
HADOOP_HOMEï¼šhadoopå®‰è£…ç›®å½•
HADOOP_CONF_DIRï¼šhadoopé›†ç¾¤çš„é…ç½®æ–‡ä»¶çš„ç›®å½•
SPARK_MASTER_IPï¼šsparké›†ç¾¤çš„MasterèŠ‚ç‚¹çš„ipåœ°å€
SPARK_WORKER_MEMORYï¼šæ¯ä¸ªworkerèŠ‚ç‚¹èƒ½å¤Ÿæœ€å¤§åˆ†é…ç»™exectorsçš„å†…å­˜å¤§å°
SPARK_WORKER_CORESï¼šæ¯ä¸ªworkerèŠ‚ç‚¹æ‰€å æœ‰çš„CPUæ ¸æ•°ç›®
SPARK_WORKER_INSTANCESï¼šæ¯å°æœºå™¨ä¸Šå¼€å¯çš„workerèŠ‚ç‚¹çš„æ•°ç›®
    
    #+END_SRC


  - slaves
    #+BEGIN_SRC 
master
slave01
slave02
    #+END_SRC


  slave sync

  scp -r spark-2.2.1-bin-hadoop2.7/ manue1@192.168.1.109:/home/manue1/opt
** spark start

   nohup sh /home/manue1/opt/hadoop-2.7.5/sbin/start-all.sh &  #å¯åŠ¨hdfså³å¯

   $SPARK_HOME/sbin/start-all.sh


   WebUI
   http://master:8080/

   spark-shell.sh è¿è¡Œåå¯ä»¥è®¿é—®åå°æ‰§è¡Œçš„ä»»åŠ¡
   http://master:4040/

   spark-submit yarn ç®¡ç†æ–¹å¼
   http://master:8088/
   
