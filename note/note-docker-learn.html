<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2019-01-24 Thu 21:14 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Docker能替代Vbox吗?</title>
<meta name="generator" content="Org mode">
<meta name="author" content="manue1">
<link rel="stylesheet" type="text/css" href="css/worg.css" />
<!-- <link rel="shortcut icon" href="http://www.langdebuqing.com/images/favicon.ico" type="image/x-icon" /> -->
</head>
<body>
<div id="preamble" class="status">
<div id="navbar">
    <ul>
        <li id="site-master"><a href="https://www.manue1.site/">Manue1's Journal</a></li>
        <li><a class="navbar-item" href="https://www.manue1.site/write.html">All Posts</a> </li>
        <li><a class="navbar-item" href="https://www.manue1.site/link.html">Links</a> </li>
        <li class="search">
            <form action="http://google.com/search" method="get" accept-charset="utf-8">
                <input type="search" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Search..">
                <input type="hidden" name="q" value="site:www.manue1.com">
            </form>
        </li>
    </ul>
</div>
</div>
<div id="content">
<h1 class="title">Docker能替代Vbox吗?</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb203555">1. Docker入门</a>
<ul>
<li><a href="#orga64568c">1.1. 初识Docker</a></li>
<li><a href="#orga360c05">1.2. Docker核心概念</a></li>
<li><a href="#orgb0536c0">1.3. Docker install</a></li>
</ul>
</li>
<li><a href="#org76e0e7a">2. Docker Image</a>
<ul>
<li><a href="#org2d5cd9c">2.1. 获取镜像</a></li>
<li><a href="#org286c533">2.2. 查看镜像信息</a></li>
<li><a href="#org14f5cb1">2.3. 搜寻镜像</a></li>
<li><a href="#org445f712">2.4. 删除镜像</a></li>
<li><a href="#orgee96ae8">2.5. 创建镜像</a></li>
<li><a href="#orgc5a7901">2.6. 存出和载入镜像</a></li>
<li><a href="#org200a33b">2.7. 上传镜像</a></li>
</ul>
</li>
<li><a href="#org3e467e8">3. Docker Container</a>
<ul>
<li><a href="#org0724280">3.1. 创建容器</a></li>
<li><a href="#orgfa3a2ba">3.2. 启动终止容器</a></li>
<li><a href="#org112b30e">3.3. 进入容器</a></li>
<li><a href="#orgdfc3adf">3.4. 删除容器</a></li>
<li><a href="#org6bb5289">3.5. 导入和导出容器</a></li>
</ul>
</li>
<li><a href="#org863ed88">4. Docker Data</a>
<ul>
<li><a href="#orgf489c93">4.1. Data Volumes</a></li>
<li><a href="#orga608af1">4.2. Data Volume Containers</a></li>
<li><a href="#orgab6bbda">4.3. 利用数据卷容器迁移数据</a></li>
</ul>
</li>
<li><a href="#orgca43494">5. Docker network</a>
<ul>
<li><a href="#org8ce13ac">5.1. 端口映射实现访问容器</a></li>
<li><a href="#org0e93e19">5.2. 容器互联实现容器间通信</a></li>
</ul>
</li>
<li><a href="#org4f382c9">6. Dockerfile</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb203555" class="outline-2">
<h2 id="orgb203555"><span class="section-number-2">1</span> Docker入门</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orga64568c" class="outline-3">
<h3 id="orga64568c"><span class="section-number-3">1.1</span> 初识Docker</h3>
<div class="outline-text-3" id="text-1-1">
<p>
可以简单的将Docker容器理解为一种沙盒，每个容器内运行一个应用，不同的容器互相<br>
隔离，容器之间可以建立通信机制。容器的创建和停止都十分快速，容器自身对资源的<br>
需求也十分有限，远远低于虚拟机。<br>
</p>

<p>
与传统虚拟机比较，Docker容器快，对系统资源需求少，一台主机可以运行数千个<br>
Docker容器,docker通过git的操作管理减少学习成本，通过Dockerfile配置文件来<br>
灵活自动化创建和部署<br>
</p>

<p>
传统方式是硬件层面实现虚拟化，需要有额外的虚拟机管理应用和虚拟机操作系统层，<br>
Docker容器是操作系统层面上实现的虚拟化，直接复用本地主机的操作系统，因此更加<br>
轻量级<br>
</p>
</div>
</div>

<div id="outline-container-orga360c05" class="outline-3">
<h3 id="orga360c05"><span class="section-number-3">1.2</span> Docker核心概念</h3>
<div class="outline-text-3" id="text-1-2">
<ol class="org-ol">
<li>Image<br></li>
<li><p>
Container<br>
</p>

<p>
镜像自身是只读的，容器从镜像启动的时候，Docker会在镜像的最上层创建<br>
一个可写层，镜像本身将保持不变<br>
</p></li>
<li><p>
Repository<br>
</p>

<p>
Docker集中存放镜像文件的场所<br>
</p>

<p>
目前最大的公开仓库是Docker Hub 国内 Docker Pool<br>
</p>

<p>
Registry 注册服务器包含众多Repository<br>
</p></li>
</ol>
</div>
</div>

<div id="outline-container-orgb0536c0" class="outline-3">
<h3 id="orgb0536c0"><span class="section-number-3">1.3</span> Docker install</h3>
<div class="outline-text-3" id="text-1-3">
<p>
安装docker<a href="https://docs.docker.com/engine/installation/">官网</a> 有详细说明,国内网速很慢，采用了阿里云的<a href="https://yq.aliyun.com/articles/7695">镜像源</a><br>
</p>

<pre class="example">
curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/intranet | sh -

</pre>
</div>
</div>
</div>
<div id="outline-container-org76e0e7a" class="outline-2">
<h2 id="org76e0e7a"><span class="section-number-2">2</span> Docker Image</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org2d5cd9c" class="outline-3">
<h3 id="org2d5cd9c"><span class="section-number-3">2.1</span> 获取镜像</h3>
<div class="outline-text-3" id="text-2-1">
<p>
docker pull NAME[: TAG]<br>
</p>

<p>
<code>docker pull ubuntu</code><br>
</p>

<p>
<code>docker pull registry.hub.docker.com/ubuntu :latest</code><br>
</p>

<p>
不指定TAG默认选择latest标签,最新版本的镜像<br>
</p>
</div>
</div>

<div id="outline-container-org286c533" class="outline-3">
<h3 id="org286c533"><span class="section-number-3">2.2</span> 查看镜像信息</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<code>docker images</code>  #查看本地所有镜像<br>
</p>

<p>
<code>docker inspect 747cb2d60bbe</code> #查看镜像信息<br>
</p>
</div>
</div>

<div id="outline-container-org14f5cb1" class="outline-3">
<h3 id="org14f5cb1"><span class="section-number-3">2.3</span> 搜寻镜像</h3>
<div class="outline-text-3" id="text-2-3">
<p>
<code>docker search mysql</code> #搜索远端仓库中共享的镜像<br>
</p>

<p>
<code>docker search k8s --no-trunc=false --filter=stars=1 --filter=is-automated=true</code><br>
</p>

<blockquote>
<p>
&#x2013;filter=is-automated=true #只显示自动创建的镜像<br>
</p>

<p>
&#x2013;no-trunc=false  #输出信息不截断显示<br>
</p>

<p>
&#x2013;filter=stars=0 #指定星级以上的镜像<br>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org445f712" class="outline-3">
<h3 id="org445f712"><span class="section-number-3">2.4</span> 删除镜像</h3>
<div class="outline-text-3" id="text-2-4">
<p>
docker rmi IMAGE[IMAGE..] #IMAGE可以是标签或者是ID<br>
</p>

<p>
<code>docker rmi ff4 -f</code><br>
</p>

<p>
image 创建的容器存在的时候，是无法删除的 -f 强制删除<br>
</p>
</div>
</div>

<div id="outline-container-orgee96ae8" class="outline-3">
<h3 id="orgee96ae8"><span class="section-number-3">2.5</span> 创建镜像</h3>
<div class="outline-text-3" id="text-2-5">
<ol class="org-ol">
<li><p>
基于已有image的容器创建<br>
</p>

<p>
docker commit [OPTIONS] CONTAINER [REPOSITORY[: TAG]]<br>
</p>

<p>
<code>docker commit -m "add a test" -a 'manue1' -p 836 centos_test:v1.0</code><br>
</p>

<blockquote>
<p>
-a 作者 -m  提交信息 -p 提交时暂停容器运行<br>
</p>
</blockquote></li>
<li><p>
基于本地模版导入<br>
</p>

<p>
<a href="https://openvz.org/Download/template/precreated">下载系统镜像模板</a><br>
</p>

<p>
cat xx.tar.gz | docker import - ubuntu:16.04<br>
</p></li>
<li>基于Dockerfile创建（推荐）<br></li>
</ol>
</div>
</div>
<div id="outline-container-orgc5a7901" class="outline-3">
<h3 id="orgc5a7901"><span class="section-number-3">2.6</span> 存出和载入镜像</h3>
<div class="outline-text-3" id="text-2-6">
<p>
docker save -o ubuntu-16.04.tar ubuntu:latest<br>
</p>

<p>
docker load &#x2013;input ubuntu-16.04.tar<br>
</p>
</div>
</div>

<div id="outline-container-org200a33b" class="outline-3">
<h3 id="org200a33b"><span class="section-number-3">2.7</span> 上传镜像</h3>
<div class="outline-text-3" id="text-2-7">
<p>
docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]<br>
</p>

<p>
docker push TARGET_IMAGE[: TAG]<br>
</p>

<p>
需要先修改本地仓库name为远程仓库名，必须先创建远程仓库manue1sec/test<br>
</p>

<p>
<code>docker tag 3a4 manue1sec/test:u_test</code><br>
</p>

<p>
<code>docker push manue1sec/test</code><br>
</p>
</div>
</div>
</div>
<div id="outline-container-org3e467e8" class="outline-2">
<h2 id="org3e467e8"><span class="section-number-2">3</span> Docker Container</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org0724280" class="outline-3">
<h3 id="org0724280"><span class="section-number-3">3.1</span> 创建容器</h3>
<div class="outline-text-3" id="text-3-1">
<p>
<code>docker create -it ubuntu</code><br>
</p>

<p>
<code>docker run -it ubuntu /bin/bash</code> (推荐)<br>
</p>
<blockquote>
<p>
#创建并启动容器<br>
-t 启动一个虚拟终端<br>
-i 保持终端<br>
-d 在后台守护运行<br>
-P Publish all exposed ports to random ports<br>
-v 数据卷<br>
&#x2013;rm  Automatically remove the container when it exits<br>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgfa3a2ba" class="outline-3">
<h3 id="orgfa3a2ba"><span class="section-number-3">3.2</span> 启动终止容器</h3>
<div class="outline-text-3" id="text-3-2">
<p>
docker start d3e<br>
</p>

<p>
docker kill ce5<br>
</p>

<p>
docker ps -a #显示所有容器<br>
</p>
</div>
</div>
<div id="outline-container-org112b30e" class="outline-3">
<h3 id="org112b30e"><span class="section-number-3">3.3</span> 进入容器</h3>
<div class="outline-text-3" id="text-3-3">
<p>
docker attach 18a<br>
</p>

<p>
docker exec -ti 24c /bin/bash  (推荐)<br>
</p>
</div>
</div>
<div id="outline-container-orgdfc3adf" class="outline-3">
<h3 id="orgdfc3adf"><span class="section-number-3">3.4</span> 删除容器</h3>
<div class="outline-text-3" id="text-3-4">
<p>
<code>docker rm 18a</code><br>
</p>
</div>
</div>
<div id="outline-container-org6bb5289" class="outline-3">
<h3 id="org6bb5289"><span class="section-number-3">3.5</span> 导入和导出容器</h3>
<div class="outline-text-3" id="text-3-5">
<p>
docker export 18a &gt; ubuntu_container.tar  作为镜像<br>
</p>

<p>
docker import a.tar<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org863ed88" class="outline-2">
<h2 id="org863ed88"><span class="section-number-2">4</span> Docker Data</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-orgf489c93" class="outline-3">
<h3 id="orgf489c93"><span class="section-number-3">4.1</span> Data Volumes</h3>
<div class="outline-text-3" id="text-4-1">
<p>
数据卷是一个可供容器使用的特殊目录,它绕过文件系统,类似于文件mount操作<br>
</p>

<ol class="org-ol">
<li>数据卷可以在容器之间共享和重用<br></li>
<li>对数据卷的修改会立马生效<br></li>
<li>对数据卷的更新不会影响镜像<br></li>
<li>卷会一直存在直到没有容器使用<br></li>

<li><p>
创建数据卷<br>
</p>

<p>
<code>docker run -dit -P --name web -v /tmp/webapp training/webapp python app.py</code><br>
</p>
<blockquote>
<p>
-v 数据卷挂在容器内/tmp/webapp     #多次使用可以创建多个数据卷<br>
</p>

<p>
-v /src/webapp:/tmp/webapp:ro  加载主机的/src/webapp目录到容器的/tmp/webapp :ro为修改默认rw权限为只读<br>
</p>
</blockquote>
<p>
<code>docker run  -itd --rm -P --name iou  -v ~/github/web-iou-docker/iou-web:/tmp/web-iou  a35 /bin/bash</code><br>
</p></li>
</ol>
</div>
</div>

<div id="outline-container-orga608af1" class="outline-3">
<h3 id="orga608af1"><span class="section-number-3">4.2</span> Data Volume Containers</h3>
<div class="outline-text-3" id="text-4-2">
<p>
在容器之间共享一些持续更新的数据，最简单的方式是使用数据卷容器<br>
</p>

<p>
<code>docker run -dit -v /dbdata --name data_vc ff4</code>  #创建数据卷容器<br>
</p>

<p>
在其他容器中使用&#x2013;volumes-from来挂在dbdata容器中的数据卷<br>
</p>

<p>
<code>docker run -dit --volumes-from data_vc --name db1 ff4</code><br>
</p>

<p>
<code>docker run -dit --volumes-from data_vc --name db2 ff4</code><br>
</p>

<p>
此时在任意容器上都存在/dbdata共享目录<br>
</p>
</div>
</div>

<div id="outline-container-orgab6bbda" class="outline-3">
<h3 id="orgab6bbda"><span class="section-number-3">4.3</span> 利用数据卷容器迁移数据</h3>
<div class="outline-text-3" id="text-4-3">
<p>
通过执行worker容器来数据备份恢复<br>
</p>

<ul class="org-ul">
<li><p>
备份<br>
</p>

<p>
<code>docker run --volumes-from data_vc -v $(pwd):/backup --name back_worker ff4 tar cvf /backup/dbdata.tar /dbdata</code><br>
</p>

<p>
备份data_vc上的/dbdata目录 到本地dbdata.tar压缩文件内<br>
</p></li>

<li><p>
恢复<br>
</p>

<p>
<code>docker run --volumes-from data_vc -v $(pwd):/dbdata ff4 tar xvf /dbdata/dbdata.tar</code><br>
</p>

<p>
从本地备份tar文件恢复数据<br>
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgca43494" class="outline-2">
<h2 id="orgca43494"><span class="section-number-2">5</span> Docker network</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org8ce13ac" class="outline-3">
<h3 id="org8ce13ac"><span class="section-number-3">5.1</span> 端口映射实现访问容器</h3>
<div class="outline-text-3" id="text-5-1">
<p>
docker run -itd &#x2013;rm -P<br>
</p>

<blockquote>
<p>
-p docker_port:8080 指定映射端口<br>
</p>

<p>
-P 动态分配<br>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org0e93e19" class="outline-3">
<h3 id="org0e93e19"><span class="section-number-3">5.2</span> 容器互联实现容器间通信</h3>
</div>
</div>
<div id="outline-container-org4f382c9" class="outline-2">
<h2 id="org4f382c9"><span class="section-number-2">6</span> Dockerfile</h2>
<div class="outline-text-2" id="text-6">
<p>
dockerfile 文件书写参考官方文档 ^^<br>
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>
    <a href="">manue1</a> 搭建和维护，使用
    <a href="https://www.gnu.org/software/emacs/">Emacs</a>
    <a href="http://orgmode.org/">Org mode</a> 编辑和构建
</p>
<script src="http://www.langdebuqing.com/css/jquery-2.1.3.min.js"></script>
<script src="http://www.langdebuqing.com/css/main.js"></script>
</div>
</body>
</html>